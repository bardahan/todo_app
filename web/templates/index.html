<title>flaskToDo</title>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/styles.css') }}"
/>
<link
  rel="icon"
  href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>✅</text></svg>"
/>
<body class="container">
  <h1>Todos</h1>
  {% for todo in todos %}{% if todo[4] == "False" %}
  <p class="todoID">{{todo[0]}}</p>
  <div class="notCompletedToDos">
    <div>
      <div class="todoStatus" onclick="checkToDo({{todo[0]}})">🔲</div>
    </div>
    <input type="text" value="{{todo[1]}}" id="{{todo[0]}}" class="todoContent" />
    <button class="btnSave" onclick="editToDo({{todo[0]}})" title="save">
      💾
    </button>
    <p class="date">
      {{todo[3]}} <br />
      {{todo[2]}}
    </p>
    <div class="delete">
      <div class="todoStatus" onclick="deleteToDo({{todo[0]}})">🗑️</div>
    </div>
  </div>
  {% endif %}{% endfor %} {% for todo in todos %} {% if todo[4] == "True" %}
  <div class="completedToDos">
    <div>
      <div onclick="uncheckToDo({{todo[0]}})" class="todoStatus">✅</div>
    </div>
    <input type="text" value="{{todo[1]}}" class="todoContent" />
    <div class="btnSave" onclick="editToDo({{todo[0]}})" title="save">
    </div>
    <p class="date">
      {{todo[6]}} <br />
      {{todo[5]}}
    </p>
    <div class="delete">
      <div class="todoStatus" onclick="deleteToDo({{todo[0]}})">🗑️</div>
    </div>
  </div>
  {% endif %} {% endfor %}
  <div class="add">
    <input type="text" name="toodo" class="inputToDo" />
    <button type="submit" class="btnAdd" onclick="todo()">add todo</button>
  </div>
</body>
<!--<script src="{{ url_for('static', filename='js/script.js') }}"></script>-->
<script >
  var api_url = {{api_url|tojson}};
// Function to make API GET requests to the server on port 8001
function makeApiGetRequest(url) {
    return fetch(`${api_url}${url}`)
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error('Request failed');
            }
        });
}

function todo() {
    var input = document.querySelector(".inputToDo").value;
    makeApiGetRequest(`/add/${encodeURIComponent(input)}`)
        .then(data => {
            window.location.reload()
        })
        .catch(error => {

            console.error(error);
        });
    }

function editToDo(id) {
    var todo = document.getElementById(id).value;
    var todoID = id;
    console.log({todo})

        makeApiGetRequest(`/edit/${encodeURIComponent(todoID)}/${encodeURIComponent(todo)}`)
           .then(data => {
                window.location.reload()
            })
            .catch(error => {

                console.error(error);
            });
    }

function deleteToDo(id) {
    var todoID = id;

    makeApiGetRequest(`/delete/${encodeURIComponent(todoID)}`)
       .then(data => {
            window.location.reload()
        })
        .catch(error => {
            // Handle the fetch error or request failure
            console.error(error);
        });
}

function checkToDo(id) {
    var todoID = id;

        makeApiGetRequest(`/check/${encodeURIComponent(todoID)}`)
           .then(data => {
                window.location.reload()
            })
            .catch(error => {

                console.error(error);
            });
    }

function uncheckToDo(id) {
    var todoID = id;

        makeApiGetRequest(`/uncheck/${encodeURIComponent(todoID)}`)
           .then(data => {
                window.location.reload()
            })
            .catch(error => {

                console.error(error);
            });
    }

</script>
